<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Initiation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden;
        }

        body {
            font-family: 'Crimson Text', Georgia, serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            overflow-x: hidden;
            min-height: 100vh;
            width: 100%;
            max-width: 100vw;
        }

        .container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            width: 100%;
        }

        .title {
            font-size: clamp(1.3rem, 5vw, 2.5rem);
            text-align: center;
            margin: 30px 0 50px;
            font-weight: 300;
            letter-spacing: clamp(3px, 2vw, 8px);
            text-transform: uppercase;
            color: #f5f5f5;
            text-shadow: 0 0 20px rgba(255,255,255,0.1);
        }

        .gate-title {
            font-size: clamp(1rem, 3.5vw, 1.3rem);
            margin-bottom: 30px;
            text-align: center;
            padding-bottom: 15px;
            font-weight: 300;
            letter-spacing: clamp(2px, 1.5vw, 4px);
            color: #c9a961;
            border-bottom: 1px solid rgba(201, 169, 97, 0.3);
        }

        .gate-content {
            background: rgba(30, 30, 30, 0.8);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(201, 169, 97, 0.2);
            line-height: 2;
        }

        .verse {
            margin: 25px 0;
            padding: 20px;
            border-left: 2px solid rgba(201, 169, 97, 0.5);
            font-style: italic;
            color: #c9a961;
            line-height: 1.8;
        }

        .image-container {
            margin: 30px 0;
            text-align: center;
            border: 2px solid rgba(201, 169, 97, 0.4);
            padding: 20px;
            background: rgba(0,0,0,0.5);
        }

        .puzzle-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            min-height: 250px;
        }

        .image-caption {
            margin-top: 15px;
            font-style: italic;
            color: #c9a961;
            font-size: 0.9rem;
            letter-spacing: 2px;
        }

        input {
            width: 100%;
            padding: 18px;
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
            background: rgba(30, 30, 30, 0.9);
            color: #e0e0e0;
            border: 1px solid rgba(201, 169, 97, 0.3);
            margin-bottom: 15px;
        }

        button {
            width: 100%;
            padding: 18px;
            font-size: 1.1rem;
            font-family: Georgia, serif;
            background: rgba(201, 169, 97, 0.15);
            color: #c9a961;
            border: 1px solid rgba(201, 169, 97, 0.4);
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.3s;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .feedback {
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2rem;
            font-style: italic;
            letter-spacing: 2px;
        }

        .success {
            background: rgba(76, 175, 80, 0.1);
            color: #81c784;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .error {
            background: rgba(244, 67, 54, 0.1);
            color: #e57373;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .admin-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(201, 169, 97, 0.15);
            color: #c9a961;
            border: 1px solid rgba(201, 169, 97, 0.4);
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 1000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1a1a1a;
            padding: 30px;
            border: 1px solid rgba(201, 169, 97, 0.3);
            width: 90%;
            max-width: 500px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin: 25px 0;
            width: 100%;
            max-width: 100%;
            overflow-x: auto;
        }

        .grid-cell {
            aspect-ratio: 1;
            border: 1px solid rgba(201, 169, 97, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(30, 30, 30, 0.8);
            color: #c9a961;
            font-size: 0.85rem;
        }

        .tile-option {
            padding: 12px 15px;
            border: 1px solid rgba(201, 169, 97, 0.3);
            margin: 4px;
            background: rgba(30, 30, 30, 0.8);
            color: #c9a961;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
            text-align: center;
            flex-shrink: 0;
        }

        /* Jigsaw puzzle styles */
        .jigsaw-container {
            max-width: 450px;
            margin: 30px auto;
        }

        .jigsaw-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin: 20px 0;
            background: rgba(201, 169, 97, 0.1);
            padding: 4px;
            border: 2px solid rgba(201, 169, 97, 0.3);
        }

        .jigsaw-piece {
            aspect-ratio: 1;
            cursor: pointer;
            border: 2px solid rgba(201, 169, 97, 0.4);
            background-size: 300% 300%;
            transition: transform 0.2s, box-shadow 0.2s, border 0.2s;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .jigsaw-piece:active {
            transform: scale(0.95);
        }

        .final-reveal {
            text-align: center;
            padding: 100px 20px;
            animation: fadeIn 4s ease-in;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .final-sentence {
            font-size: 2rem;
            line-height: 2.5;
            color: #c9a961;
            font-style: italic;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .title {
                margin: 20px 0 30px;
            }

            .gate-title {
                margin-bottom: 20px;
            }

            .gate-content {
                padding: 20px 15px;
                font-size: 0.95rem;
            }

            .verse {
                padding: 15px;
                font-size: 0.9rem;
                line-height: 1.6;
                margin: 20px 0;
            }

            .image-container {
                padding: 15px;
                margin: 20px 0;
            }

            .image-container svg {
                max-width: 100%;
                height: auto;
            }

            .image-caption {
                font-size: 0.8rem;
            }

            input {
                padding: 14px;
                font-size: 1rem;
            }

            button {
                padding: 14px;
                font-size: 1rem;
            }

            .grid-container {
                gap: 4px;
                margin: 15px 0;
            }

            .grid-cell {
                font-size: 0.65rem;
                padding: 4px 2px;
                min-height: 35px;
            }

            .tile-option {
                padding: 8px 10px;
                font-size: 0.75rem;
                margin: 3px 2px;
                min-width: 45px;
            }

            .jigsaw-container {
                max-width: 100%;
                padding: 0 10px;
            }

            .jigsaw-grid {
                gap: 3px;
                padding: 3px;
            }

            .jigsaw-piece {
                min-height: 80px;
            }

            .feedback {
                font-size: 1rem;
                padding: 15px;
            }

            .admin-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
                top: 10px;
                right: 10px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        /* Extra small phones */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .title {
                margin: 15px 0 25px;
            }

            .gate-content {
                padding: 15px 10px;
                font-size: 0.9rem;
            }

            .verse {
                padding: 12px;
                font-size: 0.85rem;
            }

            .image-container {
                padding: 10px;
                margin: 15px 0;
            }

            input, button {
                padding: 12px;
                font-size: 0.95rem;
            }

            .grid-cell {
                font-size: 0.6rem;
                padding: 3px 1px;
                min-height: 30px;
            }

            .tile-option {
                padding: 6px 8px;
                font-size: 0.7rem;
                margin: 2px 1px;
            }

            .jigsaw-piece {
                min-height: 60px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const HOST_PIN = '7734'; // CHANGE THIS!

        const GATES = {
            1: { title: 'GATE I', answer: 'LET' },
            2: { title: 'GATE II', answer: 'US' },
            3: { title: 'GATE III', answer: 'JUDGE' },
            4: { title: 'GATE IV', answer: 'KEBAB' },
            5: { title: 'GATE V', answer: 'SLOW FIRE MAKES MEAT TENDER' },
            6: { title: 'GATE VI', answer: 'WHERE' },
            7: { title: 'GATE VII', answer: 'FIRE' },
            8: { title: 'GATE VIII', answer: 'LEARNED' },
            9: { title: 'GATE IX', answer: 'PATIENCE' }
        };

        // Rich SVG images (keeping existing ones)
        const IMAGES = {
            gate1: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <circle cx="200" cy="150" r="80" fill="none" stroke="#c9a961" stroke-width="3"/>
                <path d="M 200 70 L 200 230" stroke="#c9a961" stroke-width="3"/>
                <path d="M 120 150 L 280 150" stroke="#c9a961" stroke-width="3"/>
                <circle cx="200" cy="150" r="40" fill="none" stroke="#c9a961" stroke-width="2" stroke-dasharray="5,5"/>
                <text x="200" y="270" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle" font-style="italic">The key is the lock</text>
            </svg>`,

            gate2: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <circle cx="150" cy="150" r="60" fill="none" stroke="#c9a961" stroke-width="3"/>
                <circle cx="250" cy="150" r="60" fill="none" stroke="#c9a961" stroke-width="3"/>
                <path d="M 150 90 Q 200 120 250 90" fill="none" stroke="#c9a961" stroke-width="2"/>
                <path d="M 150 210 Q 200 180 250 210" fill="none" stroke="#c9a961" stroke-width="2"/>
                <ellipse cx="200" cy="150" rx="80" ry="60" fill="none" stroke="#c9a961" stroke-width="3" opacity="0.5"/>
                <text x="200" y="270" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle" font-style="italic">Two become one</text>
            </svg>`,

            gate3: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <line x1="200" y1="60" x2="200" y2="240" stroke="#c9a961" stroke-width="3"/>
                <line x1="100" y1="60" x2="300" y2="60" stroke="#c9a961" stroke-width="3"/>
                <line x1="110" y1="60" x2="110" y2="90" stroke="#c9a961" stroke-width="2"/>
                <line x1="290" y1="60" x2="290" y2="90" stroke="#c9a961" stroke-width="2"/>
                <rect x="90" y="90" width="40" height="30" fill="none" stroke="#c9a961" stroke-width="2"/>
                <rect x="270" y="90" width="40" height="30" fill="none" stroke="#c9a961" stroke-width="2"/>
                <circle cx="200" cy="250" r="20" fill="none" stroke="#c9a961" stroke-width="3"/>
                <text x="200" y="285" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle" font-style="italic">Act of Pappa?</text>
            </svg>`,

            gate4: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <circle cx="200" cy="120" r="70" fill="none" stroke="#c9a961" stroke-width="3"/>
                <text x="200" y="70" font-family="Georgia" font-size="20" fill="#c9a961" text-anchor="middle"</text>
                <text x="200" y="130" font-family="Georgia" font-size="24" fill="#c9a961" text-anchor="middle" font-weight="bold">?</text>
                <text x="130" y="180" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle"></text>
                <text x="270" y="180" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle"></text>
                <text x="130" y="220" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle"></text>
                <text x="270" y="220" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle"></text>
                <text x="200" y="280" font-family="Georgia" font-size="14" fill="#c9a961" text-anchor="middle" font-style="italic">pleasure of bouba</text>
            </svg>`,

            gate5: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <path d="M 200 80 L 180 140 L 220 140 Z" fill="none" stroke="#c9a961" stroke-width="3"/>
                <path d="M 200 140 L 180 200 L 220 200 Z" fill="none" stroke="#c9a961" stroke-width="3"/>
                <path d="M 200 200 L 170 260 L 230 260 Z" fill="none" stroke="#c9a961" stroke-width="3"/>
                <circle cx="200" cy="65" r="8" fill="#c9a961"/>
                <line x1="150" y1="260" x2="250" y2="260" stroke="#c9a961" stroke-width="4"/>
                <text x="200" y="285" font-family="Georgia" font-size="14" fill="#c9a961" text-anchor="middle" font-style="italic">Time transforms through heat</text>
            </svg>`,

            gate6: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <circle cx="200" cy="120" r="50" fill="none" stroke="#c9a961" stroke-width="3" stroke-dasharray="10,5"/>
                <text x="200" y="130" font-family="Georgia" font-size="36" fill="#c9a961" text-anchor="middle">?</text>
                <path d="M 140 170 L 200 220 L 260 170" fill="none" stroke="#c9a961" stroke-width="3"/>
                <text x="200" y="255" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle">Culture</text>
                <text x="200" y="285" font-family="Georgia" font-size="14" fill="#c9a961" text-anchor="middle" font-style="italic">The question that seeks place</text>
            </svg>`,

            gate7: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <g transform="translate(50, 50)">
                    <text x="0" y="0" font-family="Courier" font-size="20" fill="#888" letter-spacing="8">F â–‘ L â–‘ T â–‘ E</text>
                    <text x="0" y="35" font-family="Courier" font-size="20" fill="#888" letter-spacing="8">â–‘ I â–‘ A â–‘ M â–‘</text>
                    <text x="0" y="70" font-family="Courier" font-size="20" fill="#888" letter-spacing="8">â–‘ â–‘ T â–‘ R â–‘ A</text>
                    <text x="0" y="105" font-family="Courier" font-size="20" fill="#888" letter-spacing="8">â–‘ Râ–‘ â–‘ B â–‘ E â–‘</text>
                    <text x="0" y="140" font-family="Courier" font-size="20" fill="#888" letter-spacing="8">â–‘ Eâ–‘ â–‘G â–‘ I â–‘ S </text>
                    <text x="0" y="175" font-family="Courier" font-size="20" fill="#888" letter-spacing="8">â–‘ â–‘ â–‘ â–‘ â–‘ L â–‘</text>
                </g>
               
                <text x="200" y="285" font-family="Georgia" font-size="14" fill="#c9a961" text-anchor="middle" font-style="italic">Follow the golden heat</text>
            </svg>`,

            gate8: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <circle cx="120" cy="120" r="40" fill="none" stroke="#888" stroke-width="2"/>
                <text x="120" y="130" font-family="Georgia" font-size="16" fill="#888" text-anchor="middle">KNOWN</text>
                <circle cx="280" cy="120" r="40" fill="none" stroke="#c9a961" stroke-width="3"/>
                <text x="280" y="130" font-family="Georgia" font-size="16" fill="#c9a961" text-anchor="middle">?</text>
                <path d="M 120 170 L 120 210 M 280 170 L 280 210" stroke="#c9a961" stroke-width="2"/>
                <text x="120" y="230" font-family="Georgia" font-size="12" fill="#888" text-anchor="middle">Innate</text>
                <text x="280" y="230" font-family="Georgia" font-size="12" fill="#c9a961" text-anchor="middle">Earned</text>
                <text x="200" y="275" font-family="Georgia" font-size="14" fill="#c9a961" text-anchor="middle" font-style="italic">Through time and repetition</text>
            </svg>`,

            gate9: `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="400" height="300" fill="#1a1a1a"/>
                <path d="M 150 60 L 250 60 L 220 110 L 200 150 L 180 110 Z" fill="none" stroke="#c9a961" stroke-width="3"/>
                <circle cx="200" cy="150" r="5" fill="#c9a961"/>
                <path d="M 180 190 L 200 150 L 220 190 L 250 240 L 150 240 Z" fill="none" stroke="#c9a961" stroke-width="3"/>
                <line x1="140" y1="60" x2="260" y2="60" stroke="#c9a961" stroke-width="3"/>
                <line x1="140" y1="240" x2="260" y2="240" stroke="#c9a961" stroke-width="3"/>
                <text x="200" y="280" font-family="Georgia" font-size="14" fill="#c9a961" text-anchor="middle" font-style="italic">Time bound, yet timeless</text>
            </svg>`
        };

        function App() {
            const [progress, setProgress] = useState({
                currentGate: 1,
                completedGates: [],
                awaitingHost: false,
                gameComplete: false,
                attempts: {}
            });

            const [feedback, setFeedback] = useState(null);
            const [showAdmin, setShowAdmin] = useState(false);
            const [answer, setAnswer] = useState('');
            const [jigsawGrid, setJigsawGrid] = useState(Array(14).fill(''));

            const logAttempt = (gate, attempt, correct) => {
                const key = `gate_${gate}`;
                setProgress(prev => ({
                    ...prev,
                    attempts: {
                        ...prev.attempts,
                        [key]: [...(prev.attempts[key] || []), {
                            attempt,
                            correct,
                            timestamp: new Date().toISOString()
                        }]
                    }
                }));
            };

            const checkAnswer = (gate, correctAnswer, userAnswer) => {
                const normalized = userAnswer.trim().toUpperCase();
                if (normalized === correctAnswer) {
                    setFeedback({ type: 'success', message: getSuccessMessage(gate) });
                    logAttempt(gate, userAnswer, true);
                    setTimeout(() => {
                        if (gate === 9) {
                            setProgress(prev => ({ ...prev, gameComplete: true, completedGates: [...prev.completedGates, gate] }));
                        } else {
                            setProgress(prev => ({
                                ...prev,
                                awaitingHost: true,
                                completedGates: [...prev.completedGates, gate]
                            }));
                        }
                        setAnswer('');
                        setFeedback(null);
                    }, 2000);
                } else {
                    setFeedback({ type: 'error', message: getErrorMessage(gate) });
                    logAttempt(gate, userAnswer, false);
                }
            };

            const handleJigsawSubmit = () => {
                const correctPhrase = ['IR', 'SL', 'AT', ' F', 'EN', 'E ', 'OW','MA',  'S ', 'ME',  ' T', 'KE', 'DE', 'R'];
                const userPhrase = jigsawGrid.filter(p => p).join('');
                const correctFull = correctPhrase.join('');
                
                // Check if user's arrangement matches "SLOW FIRE MAKES MEAT TENDER"
                if (userPhrase === correctFull || userPhrase.replace(/\s/g, '') === 'SLOWFIREMAKESMEATTENDER') {
                    setFeedback({ type: 'success', message: 'Ancient wisdom revealed.' });
                    logAttempt(5, jigsawGrid.join(''), true);
                    setTimeout(() => {
                        setProgress(prev => ({
                            ...prev,
                            awaitingHost: true,
                            completedGates: [...prev.completedGates, 5]
                        }));
                        setJigsawGrid(Array(14).fill(''));
                        setFeedback(null);
                    }, 2000);
                } else {
                    setFeedback({ type: 'error', message: 'Not the right order.' });
                    logAttempt(5, jigsawGrid.join(''), false);
                }
            };

            const getSuccessMessage = (gate) => {
                const messages = {
                    1: 'Permission granted.',
                    2: 'Unified.',
                    3: 'Sovereignty achieved.',
                    4: 'The invariant revealed.',
                    5: 'Ancient wisdom revealed.',
                    6: 'The inquiry stands.',
                    7: 'Light breaks through.',
                    8: 'Knowledge earned.',
                    9: 'The final virtue embodied.'
                };
                return messages[gate] || 'Truth.';
            };

            const getErrorMessage = (gate) => {
                const messages = {
                    1: 'The gate remains closed.',
                    2: 'Division persists.',
                    3: 'External forces bind you.',
                    4: 'It changes. Try again.',
                    5: 'The wisdom eludes you.',
                    6: 'The question is wrong.',
                    7: 'Still in darkness.',
                    8: 'Not yet acquired.',
                    9: 'Haste defeats you.'
                };
                return messages[gate] || 'No.';
            };

            const hostApprove = (pin) => {
                if (pin === HOST_PIN) {
                    setProgress(prev => ({
                        ...prev,
                        currentGate: prev.currentGate + 1,
                        awaitingHost: false
                    }));
                    setShowAdmin(false);
                    setFeedback({ type: 'success', message: 'Passage granted.' });
                    setTimeout(() => setFeedback(null), 2000);
                } else {
                    setFeedback({ type: 'error', message: 'Denied.' });
                }
            };

            const resetProgress = () => {
                if (confirm('Restart from the beginning?')) {
                    window.location.reload();
                }
            };

            if (progress.gameComplete) {
                return <FinalRevealSequence />;
            }

            if (progress.awaitingHost) {
                return (
                    <>
                        <AdminPanel 
                            onApprove={hostApprove}
                            onReset={resetProgress}
                            progress={progress}
                            show={showAdmin}
                            setShow={setShowAdmin}
                        />
                        <div style={{textAlign: 'center', padding: '80px 20px', minHeight: '70vh'}}>
                            <h2 style={{fontSize: '2rem', margin: '40px 0', letterSpacing: '6px', fontWeight: 300, color: '#c9a961'}}>
                                Return to Kiki.
                            </h2>
                            <div style={{color: '#888', fontStyle: 'italic', marginTop: '30px'}}>
                                The gate yields. Await the seal.
                            </div>
                        </div>
                    </>
                );
            }

            return (
                <>
                    <AdminPanel 
                        onApprove={hostApprove}
                        onReset={resetProgress}
                        progress={progress}
                        show={showAdmin}
                        setShow={setShowAdmin}
                    />
                    <div className="container">
                        <h1 className="title">Initiation</h1>
                        
                        {feedback && (
                            <div className={`feedback ${feedback.type}`}>
                                {feedback.message}
                            </div>
                        )}
                        <Gate 
                            number={progress.currentGate}
                            answer={answer}
                            setAnswer={setAnswer}
                            jigsawGrid={jigsawGrid}
                            setJigsawGrid={setJigsawGrid}
                            onSubmit={() => {
                                if (progress.currentGate === 5) {
                                    handleJigsawSubmit();
                                } else {
                                    checkAnswer(progress.currentGate, GATES[progress.currentGate].answer, answer);
                                }
                            }}
                        />
                    </div>
                </>
            );
        }

        function AdminPanel({ onApprove, onReset, progress, show, setShow }) {
            const [pin, setPin] = useState('');
            const [authenticated, setAuthenticated] = useState(false);
            const [showAnswers, setShowAnswers] = useState(false);

            const handlePinSubmit = () => {
                if (pin === HOST_PIN) {
                    setAuthenticated(true);
                } else {
                    alert('Denied');
                    setPin('');
                }
            };

            const handleApprove = () => {
                onApprove(pin);
                setPin('');
                setAuthenticated(false);
            };

            const handleClose = () => {
                setShow(false);
                setAuthenticated(false);
                setPin('');
                setShowAnswers(false);
            };

            return (
                <>
                    <button className="admin-btn" onClick={() => setShow(true)}>âš™</button>
                    <div className={`modal ${show ? 'active' : ''}`} onClick={handleClose}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                            <h3 style={{marginBottom: '20px', letterSpacing: '3px', textAlign: 'center', color: '#c9a961'}}>
                                HOST PANEL
                            </h3>
                            
                            {!authenticated ? (
                                <div>
                                    <p style={{marginBottom: '20px', color: '#888', textAlign: 'center'}}>
                                        Enter host seal
                                    </p>
                                    <input
                                        type="password"
                                        placeholder="PIN"
                                        value={pin}
                                        onChange={(e) => setPin(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handlePinSubmit()}
                                    />
                                    <button onClick={handlePinSubmit}>Authenticate</button>
                                    <button onClick={handleClose}>Cancel</button>
                                </div>
                            ) : (
                                <div>
                                    <div style={{marginBottom: '15px', color: '#999'}}>
                                        Gate: {progress.currentGate} | Completed: {progress.completedGates.join(', ') || 'None'}
                                    </div>
                                    
                                    {progress.awaitingHost && (
                                        <div style={{marginTop: '20px', marginBottom: '20px'}}>
                                            <p style={{color: '#81c784', marginBottom: '15px'}}>
                                                âœ“ Gate {progress.completedGates[progress.completedGates.length - 1]} complete
                                            </p>
                                            <button onClick={handleApprove}>Grant Passage</button>
                                        </div>
                                    )}
                                    
                                    <button onClick={onReset}>Reset All</button>
                                    <button onClick={() => setShowAnswers(!showAnswers)}>
                                        {showAnswers ? 'Hide' : 'Show'} Keys
                                    </button>
                                    
                                    {showAnswers && (
                                        <div style={{marginTop: '15px', padding: '15px', background: 'rgba(0,0,0,0.5)', fontSize: '0.9rem'}}>
                                            {Object.entries(GATES).map(([num, gate]) => (
                                                <div key={num} style={{margin: '5px 0', color: '#c9a961'}}>
                                                    {num}: {gate.answer}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    
                                    <button onClick={handleClose}>Close</button>
                                </div>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        // INTERACTIVE JIGSAW PUZZLE COMPONENT
        function JigsawPuzzle({ onComplete }) {
            const [pieces, setPieces] = useState(() => {
                // Start with shuffled positions
                const positions = [0, 1, 2, 3, 4, 5, 6, 7, 8];
                for (let i = positions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [positions[i], positions[j]] = [positions[j], positions[i]];
                }
                return positions.map((pos, index) => ({
                    id: index,
                    currentPos: pos
                }));
            });

            const [selectedPiece, setSelectedPiece] = useState(null);

            const handlePieceClick = (pieceId) => {
                if (selectedPiece === null) {
                    // First click - select this piece
                    setSelectedPiece(pieceId);
                } else if (selectedPiece === pieceId) {
                    // Clicking same piece - deselect
                    setSelectedPiece(null);
                } else {
                    // Second click - swap pieces
                    setPieces(prevPieces => {
                        const newPieces = [...prevPieces];
                        const piece1Index = newPieces.findIndex(p => p.id === selectedPiece);
                        const piece2Index = newPieces.findIndex(p => p.id === pieceId);

                        // Swap positions
                        [newPieces[piece1Index].currentPos, newPieces[piece2Index].currentPos] = 
                        [newPieces[piece2Index].currentPos, newPieces[piece1Index].currentPos];

                        // Check if solved
                        const solved = newPieces.every(p => p.id === p.currentPos);
                        if (solved) {
                            setTimeout(() => onComplete(), 1000);
                        }

                        return newPieces;
                    });

                    setSelectedPiece(null);
                }
            };

            const getPieceStyle = (pieceId) => {
                const row = Math.floor(pieceId / 3);
                const col = pieceId % 3;
                
                return {
                    backgroundImage: 'linear-gradient(135deg, #E30A17 0%, #E30A17 100%)',
                    backgroundSize: '300% 300%',
                    backgroundPosition: `${-col * 100}% ${-row * 100}%`,
                    position: 'relative',
                    overflow: 'hidden',
                    cursor: 'pointer',
                    border: selectedPiece === pieceId ? '3px solid #c9a961' : '2px solid rgba(201, 169, 97, 0.4)',
                    boxShadow: selectedPiece === pieceId ? '0 0 20px rgba(201, 169, 97, 0.8)' : 'none',
                    transform: selectedPiece === pieceId ? 'scale(0.95)' : 'scale(1)',
                    transition: 'all 0.2s ease'
                };
            };

            const renderPieceContent = (pieceId) => {
                // Turkish flag split into 9 pieces
                const row = Math.floor(pieceId / 3);
                const col = pieceId % 3;
                
                // Create SVG elements based on piece position
                if (pieceId === 4) { // Center piece - has crescent and star
                    return (
                        <svg width="100%" height="100%" viewBox="0 0 200 200" preserveAspectRatio="none" style={{position: 'absolute', top: 0, left: 0, pointerEvents: 'none'}}>
                            <rect width="200" height="200" fill="#E30A17"/>
                            <circle cx="80" cy="100" r="50" fill="#FFFFFF"/>
                            <circle cx="95" cy="100" r="40" fill="#E30A17"/>
                            <path d="M 130 100 L 145 130 L 115 108 L 130 108 L 100 130 Z" fill="#FFFFFF"/>
                        </svg>
                    );
                } else if (pieceId === 1 || pieceId === 7) { // Pieces with parts of crescent/star
                    return (
                        <svg width="100%" height="100%" viewBox={`${col * 200} ${row * 200} 200 200`} preserveAspectRatio="none" style={{position: 'absolute', top: 0, left: 0, pointerEvents: 'none'}}>
                            <rect width="600" height="600" fill="#E30A17"/>
                            <circle cx="240" cy="300" r="150" fill="#FFFFFF"/>
                            <circle cx="285" cy="300" r="120" fill="#E30A17"/>
                            <path d="M 390 300 L 435 390 L 345 324 L 390 324 L 300 390 Z" fill="#FFFFFF"/>
                        </svg>
                    );
                } else {
                    return (
                        <svg width="100%" height="100%" viewBox={`${col * 200} ${row * 200} 200 200`} preserveAspectRatio="none" style={{position: 'absolute', top: 0, left: 0, pointerEvents: 'none'}}>
                            <rect width="600" height="600" fill="#E30A17"/>
                            <circle cx="240" cy="300" r="150" fill="#FFFFFF"/>
                            <circle cx="285" cy="300" r="120" fill="#E30A17"/>
                            <path d="M 390 300 L 435 390 L 345 324 L 390 324 L 300 390 Z" fill="#FFFFFF"/>
                        </svg>
                    );
                }
            };

            const sortedPieces = [...pieces].sort((a, b) => a.currentPos - b.currentPos);

            return (
                <div className="jigsaw-container">
                    <div style={{
                        fontSize: 'clamp(1rem, 4vw, 1.3rem)',
                        color: '#c9a961',
                        textAlign: 'center',
                        marginBottom: '20px',
                        fontStyle: 'italic'
                    }}>
                        Tap a piece, then tap another.<br/>
                        They will swap. Form the symbol.
                    </div>

                    <div className="jigsaw-grid">
                        {sortedPieces.map((piece) => (
                            <div
                                key={piece.id}
                                className="jigsaw-piece"
                                onClick={() => handlePieceClick(piece.id)}
                                style={getPieceStyle(piece.id)}
                            >
                                {renderPieceContent(piece.id)}
                            </div>
                        ))}
                    </div>

                    <div style={{
                        textAlign: 'center',
                        marginTop: '20px',
                        color: '#888',
                        fontSize: '0.85rem',
                        fontStyle: 'italic'
                    }}>
                        Tap a piece to select it (glows gold).<br/>
                        Tap another to swap them.
                    </div>
                </div>
            );
        }

        function FinalRevealSequence() {
            const [stage, setStage] = useState('sentence');
            const [jigsawComplete, setJigsawComplete] = useState(false);

            useEffect(() => {
                if (stage === 'sentence') {
                    const timer = setTimeout(() => setStage('jigsaw'), 5000);
                    return () => clearTimeout(timer);
                }
            }, [stage]);

            useEffect(() => {
                if (jigsawComplete) {
                    setTimeout(() => setStage('reveal'), 1500);
                }
            }, [jigsawComplete]);

            if (stage === 'reveal') {
                return (
                    <div className="final-reveal">
                        <div style={{
                            fontSize: 'clamp(2rem, 12vw, 5rem)',
                            letterSpacing: 'clamp(5px, 3vw, 15px)',
                            color: '#c9a961',
                            marginBottom: '40px',
                            animation: 'finalPulse 2s ease-in-out',
                            fontWeight: '300'
                        }}>
                            TURKEY
                        </div>
                        <div style={{fontSize: 'clamp(2rem, 10vw, 4rem)', margin: '30px 0'}}>ðŸ‡¹ðŸ‡·</div>
                        <div style={{
                            fontSize: 'clamp(1rem, 4vw, 1.4rem)',
                            color: '#d0d0d0',
                            fontStyle: 'italic',
                            maxWidth: '90%',
                            margin: '40px auto',
                            lineHeight: 2
                        }}>
                            Where ancient fires still burn slow.<br/>
                            Where patience transforms meat to art.<br/>
                            Where we shall judge kebab together.
                        </div>
                        
                        <style>{`
                            @keyframes finalPulse {
                                0%, 100% { opacity: 1; transform: scale(1); }
                                50% { opacity: 0.8; transform: scale(1.05); }
                            }
                        `}</style>
                    </div>
                );
            }

            if (stage === 'jigsaw') {
                return (
                    <div className="container" style={{paddingTop: '40px'}}>
                        <div style={{
                            fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                            color: '#c9a961',
                            textAlign: 'center',
                            margin: '30px 0',
                            fontStyle: 'italic'
                        }}>
                            The words you gathered speak:
                        </div>

                        <div style={{
                            fontSize: 'clamp(1rem, 4.5vw, 1.5rem)',
                            textAlign: 'center',
                            color: '#d0d0d0',
                            fontStyle: 'italic',
                            margin: '30px 0',
                            lineHeight: 2
                        }}>
                            "Let us judge kebab<br/>
                            where fire learned patience."
                        </div>

                        <div style={{
                            fontSize: 'clamp(1.5rem, 6vw, 2rem)',
                            color: '#c9a961',
                            textAlign: 'center',
                            margin: '50px 0 30px',
                            letterSpacing: 'clamp(3px, 2vw, 6px)'
                        }}>
                            WHERE?
                        </div>

                        <JigsawPuzzle onComplete={() => setJigsawComplete(true)} />
                    </div>
                );
            }

            return (
                <div className="final-reveal">
                    <div style={{
                        fontSize: 'clamp(1.2rem, 5vw, 2rem)',
                        lineHeight: 2,
                        color: '#c9a961',
                        fontStyle: 'italic'
                    }}>
                        Let us judge kebab<br/>
                        where fire learned patience.
                    </div>
                    <div style={{
                        marginTop: '60px',
                        fontSize: '1.1rem',
                        color: '#888',
                        fontStyle: 'italic'
                    }}>
                        The nine gates have yielded their words...
                    </div>
                </div>
            );
        }

        function Gate({ number, answer, setAnswer, jigsawGrid, setJigsawGrid, onSubmit }) {
            const SVGImage = ({ data, caption }) => (
                <div className="image-container">
                    <div dangerouslySetInnerHTML={{__html: data}} />
                    {caption && <div className="image-caption">{caption}</div>}
                </div>
            );

            const gates = {
                1: (
                    <>
                        <h2 className="gate-title">GATE I</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate1} caption="The key is within the lock" />
                            <div className="verse">
                                The door asks permission of itself.<br/>
                                The word that opens is the word that grants.<br/>
                                No key exists outside the lock.
                            </div>
                            <p style={{textAlign: 'center', color: '#d0d0d0', fontStyle: 'italic'}}>
                                What single syllable permits its own utterance?
                            </p>
                        </div>
                        <input
                            type="text"
                            placeholder="Speak the word"
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                ),
                2: (
                    <>
                        <h2 className="gate-title">GATE II</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate2} caption="Two circles merge into one" />
                            <div className="verse">
                                Two rivers meet without speaking.<br/>
                                Two flames merge without negotiation.
                            </div>
                            <p style={{textAlign: 'center', color: '#d0d0d0', fontStyle: 'italic'}}>
                                Not I. Not you. What remains?
                            </p>
                        </div>
                        <input
                            type="text"
                            placeholder="The word of unity"
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                ),
                3: (
                    <>
                        <h2 className="gate-title">GATE III</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate3} caption="The scales of sovereignty" />
                            <div className="verse">
                                Like the storm, it arrives.<br/>
                                And stays like the cloud above your head.<br/>
                                You cannot stop it.<br/>
                                Nor can you escape it.
                            </div>
                            <p style={{textAlign: 'center', color: '#d0d0d0', fontStyle: 'italic'}}>
                                You fear this quality of Pappa and Mamma all the time.
                            </p>
                        </div>
                        <input
                            type="text"
                            placeholder="The act of Dio."
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                ),
                4: (
                    <>
                        <h2 className="gate-title">GATE IV</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate4} caption="One word, of our Nordstadt " />
                            <div className="verse">
                                Watching through our window.<br/>
                                Across Bodestrasse 8.<br/>
                                Forges spanning the rails.<br/>
                                Aroma persuades your dream.<br/>
                                Relishing with a Pessoa on hand,<br/>
                                and me beside you watching the lane.
                            </div>
                            <p style={{textAlign: 'center', color: '#d0d0d0', fontStyle: 'italic'}}>
                                Which dream needs no waiting, though I despise?
                            </p>
                        </div>
                        <input
                            type="text"
                            placeholder="The unchanging name"
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                ),
                5: (
                    <>
                        <h2 className="gate-title">GATE V</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate5} caption="Fire descends to the hearth" />
                            <div className="verse">
                                The ancients knew what haste forgets.<br/>
                                Time is the ingredient of the taste.
                            </div>
                            <div className="grid-container">
                                {jigsawGrid.map((cell, i) => (
                                    <div key={i} className="grid-cell">{cell || (i + 1)}</div>
                                ))}
                            </div>
                            <div style={{textAlign: 'center', marginTop: '20px', display: 'flex', flexWrap: 'wrap', justifyContent: 'center', maxWidth: '100%'}}>
                                {['AT', 'SL', 'EN', 'IR', 'S ', 'OW', 'DE', 'MA', ' T', 'KE', 'E ', ' F', 'ME', 'R'].map((tile, i) => (
                                    <div 
                                        key={i} 
                                        className="tile-option"
                                        onClick={() => {
                                            const emptyPos = jigsawGrid.findIndex(c => !c);
                                            if (emptyPos !== -1) {
                                                const newGrid = [...jigsawGrid];
                                                newGrid[emptyPos] = tile;
                                                setJigsawGrid(newGrid);
                                            }
                                        }}
                                        style={{opacity: jigsawGrid.includes(tile) ? 0.3 : 1}}
                                    >
                                        {tile}
                                    </div>
                                ))}
                            </div>
                        </div>
                        <button onClick={onSubmit}>Submit</button>
                        <button onClick={() => setJigsawGrid(Array(14).fill(''))}>Clear</button>
                    </>
                ),
                6: (
                    <>
                        <h2 className="gate-title">GATE VI</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate6} caption="The question mark above culture" />
                            <div className="verse">
                                Location is not coordinates on parchment.<br/>
                                Precedes the voyages from the dawn of time <br/>
                                The question precedes the answer.
                            </div>
                            <p style={{textAlign: 'center', color: '#d0d0d0', fontStyle: 'italic'}}>
                                Our frequent adverb, often, to ask?
                            </p>
                        </div>
                        <input
                            type="text"
                            placeholder="The question of place."
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                ),
                7: (
                    <>
                        <h2 className="gate-title">GATE VII</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate7} caption="Follow the diagonal path" />
                            <div className="verse">
                               element of life <br/>
                                Virtue of which  you like the most !<br/>
                                Look through them.<br/>
                            </div>
                        </div>
                        <input
                            type="text"
                            placeholder="The hidden word"
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                ),
                8: (
                    <>
                        <h2 className="gate-title">GATE VIII</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate8} caption="Two forms of knowledge" />
                            <div className="verse">
                                That which arrives with birthâ€”<br/>
                                Possessed without study, but drives us to know.<br/>
                                Brahman does this to be.
                            </div>
                            <p style={{textAlign: 'center', color: '#d0d0d0', fontStyle: 'italic'}}>
                                What word describes knowledge earned through time?
                            </p>
                        </div>
                        <input
                            type="text"
                            placeholder="Knowledge through time"
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                ),
                9: (
                    <>
                        <h2 className="gate-title">GATE IX</h2>
                        <div className="gate-content">
                            <SVGImage data={IMAGES.gate9} caption="The hourglass of virtue" />
                            <div className="verse">
                                Practice cultivates it.<br/>
                                <br/>
                                Time teaches it to humans.
                            </div>
                            <p style={{textAlign: 'center', color: '#d0d0d0', fontStyle: 'italic'}}>
                            " I am that;  To wait."
                            </p>
                        </div>
                        <input
                            type="text"
                            placeholder="The final virtue."
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && onSubmit()}
                        />
                        <button onClick={onSubmit}>Submit</button>
                    </>
                )
            };

            return gates[number] || <div>Gate not found</div>;
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
